{% extends 'base.html' %}

{% block breadcrumbs %}
	{{block.super}}
	<li><a href="{% url manager-emails %}">Emails</a> <span class="divider">/</span></li>
	<li><a href="{% url manager-email-update email.pk %}">{{email.title}}</a> <span class="divider">/</span></li>
	<li class="active"><a href="{% url manager-email-instances email.pk %}">Instances</a></li>
{% endblock %}

{% block page-body %}
  <h2>{{email.title}} Instances</h2>

  {% if is_paginated %}
  <div>
  	<ul class="pagination pagination-sm">
  		{% if page_obj.has_previous %}
  		<li>
  			<a href="?page={{page_obj.previous_page_number}}" class="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>Prev</a>
  		</li>
  		{% endif %}
      <li class="disabled">
        <a href="#">Page {{page_obj.number}} of {{page_obj.paginator.num_pages}}</a>
      </li>
  		{% if page_obj.has_next %}
  		<li>
  			<a href="?page={{page_obj.next_page_number}}" class="next">
          Next<span class="glyphicon glyphicon-chevron-right"></span></a>
  		</li>
  		{% endif %}
  	</ul>
  </div>
  {% endif %}

  <table class="table table-striped table-hover">
  	<thead>
  		<tr>
  			<th scope="col">Start</th>
        <th scope="col">Progress</th>
  			<th scope="col">End</th>
  			<th scope="col">In Progress</th>
  			<th scope="col">Recipient</th>
  			<th scope="col">Open Tracked</th>
  			<th scope="col">URLs Tracked</th>
  		</tr>
  	</thead>
  	<tbody>
  		{% for instance in instances %}
  		<tr data-link-url="{% url manager-email-instance instance.pk %}">
  			<td>{{instance.start}}</td>
        <td>
          Sent {{instance.sent_count}} of {{instance.recipient_details.count}}<br>
          <div class="progress">
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
              style="min-width: 2em; width: {% widthratio instance.sent_count instance.recipient_details.count 100 %}%;">
              {% widthratio instance.sent_count instance.recipient_details.count 100 %}%
            </div>
          </div>
        </td>
  			<td>{{instance.end}}</td>
  			<td>{{instance.in_progress}}</td>
  			<td>{{instance.recipients.count}}</td>
  			<td>{{instance.opens_tracked}}</td>
  			<td>{{instance.urls_tracked}}</td>
  		</tr>
  		{% endfor %}
  	</tbody>
  </table>

  {% if is_paginated %}
  <div>
    <ul class="pagination pagination-sm">
      {% if page_obj.has_previous %}
      <li>
        <a href="?page={{page_obj.previous_page_number}}" class="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>Prev</a>
      </li>
      {% endif %}
      <li class="disabled">
        <a href="#">Page {{page_obj.number}} of {{page_obj.paginator.num_pages}}</a>
      </li>
      {% if page_obj.has_next %}
      <li>
        <a href="?page={{page_obj.next_page_number}}" class="next">
          Next<span class="glyphicon glyphicon-chevron-right"></span></a>
      </li>
      {% endif %}
    </ul>
  </div>
  {% endif %}

{% endblock %}
