{% extends 'base.html' %}
{% load humanize %}
{% block footer_scripts %}
	{{block.super}}
	<script type="text/javascript">
		$().ready(function() {
			$('#instances li')
				.each(function(index, element) {
					var content = $(this).find('.content'),
						h4      = $(this).find('h4');

					if(index > 0) content.hide();
					h4.click(function() {
						var span = $(this).find('.expand');
						
						if(span.html() == '►') {
							span.html('▼');
						} else {
							span.html('►');
						}
						content.toggle();
					})

				});
		})
	</script>
{% endblock %}
{% block content %}
<div id="email-details">
	<h2>{{email.title}}</h2>
	<div>
		<strong>Send Time:</strong> {{email.send_time}} -
		<strong>Recurring:</strong> {{email.get_recurrence_display}} -
		<strong>Started On:</strong> {{email.start_date}}
		<a class="fright" href="{% url mailer-email-update email.id %}">Change Settings</a>
	</div>
	<!--
	<div id="overall">
		<h4><span>&#9660;</span>Overall</h4>
		<h5>Last 15 days of activity</h5>
		<img id="overall_stats" src="{{email.graph}}" />
		{% if not email.track_opens %}
		<p><em>Opens are not being tracked.</em></p>
		{% endif %}
		{% if not email.track_urls %}
		<p><em>URLs are not being tracked.</em></p>
		{% endif %}
	</div>
	-->
	{% for instance in email.instances.all %}
		{% if forloop.first %}
		<ul id="instances">
		{% endif %}
		<li>
			<h4>
				{% if forloop.first %}
				<span class="expand">&#9660;</span>
				{% else %}
				<span class="expand">&#9658;</span>
				{% endif %}
				{{instance.start}}
				<div class="send_stats">
					<span class="sent">
						Sent: {{instance.recipient_details.count}}
					</span>, 
					<span class="opened">
						Opened: {% if instance.opens_tracked %}{{instance.opens.count}} ({{instance.opens_percent}}){% else %}Not Tracked{% endif %}
					</span>
				</div>
			</h4>
			<div class="content">
				<table>
					<tr>
						<th scope="col">URL</th>
						<th scope="col">Position</th>
						<th scope="col">Clicks</th>
					</tr>
					{% for url in instance.urls.all %}
					<tr>
						<td>{{url.name}}</td>
						<td>{{url.position|ordinal}}</td>
						<td>{{url.clicks.count}}</td>
					</tr>
					{% endfor %}
				</table>
			</div>
		</li>
		{% if forloop.last %}
		</ul>
		{% endif %}
	{% empty %}
	<p>There are no instances of the email.</p>
	{% endfor %}
</div>
{% endblock %}