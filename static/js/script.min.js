!function(){"use strict";function t(){u?(clearInterval(r),o.parents(".alert").removeClass("alert-info").addClass("alert-danger"),o.parent().replaceWith("<strong>Error: The email send may have failed, the start time is more than 24 hours ago.</strong>"),c.slideUp()):$.ajax({url:d,data:{pk:i}}).done(function(t){if(t.end)window.location.reload();else if(t.error)o.parents(".alert").text(t.error);else if(new Date-new Date(t.start)>h)u=!0;else{var e=Math.round(t.sent_count/t.total*100);"number"==typeof e?e+="%":e="0%",o.css("width",e).text(e),s.text(t.sent_count+" of "+t.total)}}).fail(function(){clearInterval(r),o.parents(".alert").text("Error retrieving sent email data.")})}function e(){l.hasClass("open-instance-page")?window.location=INSTANCE_URL+i+"#check_on_load":(i=l.siblings("input.email-instance-id").val(),n("/email/instance/"+i+"/cancel/",l))}function n(t){$.ajax({url:t,data:{pk:i}}).success(function(t){l.children(".text").text("Cancelling Instance..."),l.children(".spinner-loader").removeClass("hidden")}).error(function(t,e,n){l.children(".text").text("Cancel This Instance"),l.children(".spinner-loader").addClass("hidden")})}function a(){var n=window.location.hash.replace("#","");c=$(".cancel-instance-form"),o=$(".progress-bar"),l=$(".cancel-instance-btn"),"check_on_load"===n&&l.length>0&&e(),i=$("input.email-instance-id").val(),o.length&&(s=$(".sent"),r=setInterval(t,2e3)),c.on("click",".cancel-instance-btn",function(t){t.preventDefault(),e()})}var i,r,o,s,c,l,d="/instance/json/?pk=",u=!1,h=864e5;$(a)}(),function(){"use strict";function t(){l.find(".attribute").each(function(t){var e=$(this).find("input");e.eq(0).attr("id","id_attributes-"+t+"-id").attr("name","attributes-"+t+"-id"),e.eq(1).attr("id","id_attributes-"+t+"-name").attr("name","attributes-"+t+"-name"),e.eq(2).attr("id","id_attributes-"+t+"-value").attr("name","attributes-"+t+"-value")})}function e(){u.val(l.find(".attribute").length)}function n(t){return t.replace(/\d+/g,function(t){return++t})}function a(a){a.preventDefault();var i=s.clone().removeClass("hide");i.appendTo(l),c?t():i.find("input").each(function(){$(this).attr("id",n($(this).attr("id"))),$(this).attr("name",n($(this).attr("name")))}),e()}function i(n){n.preventDefault(),c?($(n.target).closest(".attribute").remove(),t()):($(n.target).closest(".attribute").hide(),$(n.target).next().prop("checked",!0)),e()}function r(t){$(t.target).closest(".form-group").toggleClass("alert-"+$(t.target).attr("data-color"))}function o(){c=window.location.pathname.toString().indexOf("recipient/create/")!==-1,s=l.find(".attribute").last().clone().appendTo("body").addClass("hide"),$("form:first *:input[type=text]:first").focus(),$(".add-attr-btn").on("click",a),l.on("click","span",i),l.on("mouseover","span",r),d.on("mouseover","span",r),l.on("mouseout","span",r),d.on("mouseout","span",r)}var s,c=!1,l=$(".attribute-container"),d=$(".add-attr-container"),u=$("#id_attributes-TOTAL_FORMS");$(o)}(),function(){$("#tb_recipient_search").focus();var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("email_address"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/recipients/json/?search=%QUERY"});t.clearPrefetchCache(),t.initialize(),$("#tb_recipient_search").typeahead({hint:!1,minLength:3,limit:10,highlight:!0},{displayKey:"email_address",source:t.ttAdapter()}),$("#tb_recipient_search").bind("typeahead:selected",function(t,e,n){$("#tb_recipient_search").val(e.email_address)})}(),function(){"use strict";function t(t){var e=$(t.target).parent().attr("data-link-url");e&&(window.location=e)}function e(){$("table").on("click","td:not(:has(a))",t),$('[data-toggle="tooltip"]').tooltip()}$(e)}();